<!DOCTYPE html>
<html>
	<head>
	
	</head>
	<body>
		<div>
		  <button id="power">
		  開關
		  </button>
		  <img src="https://i.imgur.com/omX5Drl.png" style="position:absolute;top:0vw;left:0vw;height:100vh;z-index:-1">
		  
		</div>
		<script>
			class Light {
  
			  constructor() {  
				// create/append div dynamically
				// https://stackoverflow.com/questions/14004117/create-div-and-append-div-dynamically
				this.element = document.createElement ('div');
				//this = iDiv;
				this.element.id = 'light';
				// set element style attribute
				//https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/style
				this.element.style.cssText = "position:absolute;width:20px;height:20px;border-radius:15px;z-index:1"; 
				  this.element.style.top = '10vw';
				this.element.style.left = '30vw';
				// CSS color property: https://www.w3schools.com/cssref/pr_text_color.asp
				// hsl: https://www.w3schools.com/colors/colors_hsl.asp
				this.element.style.background = "hsl(89, 43%, 51%)";
				document.getElementsByTagName('body')[0].appendChild(this.element);
			  }

				changeColor() {
				// https://stackoverflow.com/questions/45147661/javascript-recursion-within-a-class/45147713
				var self = this;
				var hue = Math.random()*200;
				self.element.style.background = "hsl(" + hue + ", 43%, 51%)";  
				this.time = setTimeout (function() { self.changeColor() } , Math.random() * 1000 + 1000);
					// setTimeout ( self.changeColor , 1000);  // why this is not working ...
			  }
				
			  setTime(){
				var self = this;
				this.time = setTimeout (function() { self.changeColor() } , Math.random() * 1000 + 1000);
			  }
			  removeTime(){
				clearTimeout(this.time);
			  }
			}

			var lights = [];
			////////////////////////////////
			init();

			var isOpen = true;
			document.getElementById('power').onclick = function changePower1(){
				isOpen = !isOpen;
			  
			  var i;
			  if(isOpen){
				for(i = 0; i < lights.length; i++){
					lights[i].setTime();
				}
			  }
			  else {
				for(i = 0; i < lights.length; i++){
					lights[i].removeTime();
				  lights[i].element.style.background = "hsl(50,0%,50%)";
				}
			  }
			}

			function init() {

			  
			  var light = new Light();
			  light.element.style.top = '5vh';
			  light.element.style.left = '18vw';
			  light.changeColor();
			  lights.push(light);

			  light = new Light();
			  light.element.style.top = '10vh';
			  light.element.style.left = '17vw';
			  light.changeColor();
				lights.push(light);
			  
			  light = new Light();
			  light.element.style.top = '23vh';
			  light.element.style.left = '22vw';
			  light.changeColor();
			  lights.push(light);
			  
			  light = new Light();
			  light.element.style.top = '38vh';
			  light.element.style.left = '14vw';
			  light.changeColor();
			  lights.push(light);
			  
			  light = new Light();
			  light.element.style.top = '62vh';
			  light.element.style.left = '11vw';
			  light.changeColor();
			  lights.push(light);
			  
			  light = new Light();
			  light.element.style.top = '54vh';
			  light.element.style.left = '7vw';
			  light.changeColor();
			  lights.push(light);
			  
			  light = new Light();
			  light.element.style.top = '52vh';
			  light.element.style.left = '16vw';
			  light.changeColor();
			  lights.push(light);
			  
			  light = new Light();
			  light.element.style.top = '61vh';
			  light.element.style.left = '19vw';
			  light.changeColor();
			  lights.push(light);
			  
			  light = new Light();
			  light.element.style.top = '46vh';
			  light.element.style.left = '26vw';
			  light.changeColor();
			  lights.push(light);
			  
			  light = new Light();
			  light.element.style.top = '37vh';
			  light.element.style.left = '19vw';
			  light.changeColor();
			  lights.push(light);
			  
			  light = new Light();
			  light.element.style.top = '26vh';
			  light.element.style.left = '15vw';
			  light.changeColor();
			  lights.push(light);
			  
			}


		</script>
	</body>
</html>